---
title: "Importação de dados"
author: "P4H"
output: html_document
---

<link rel="stylesheet" href="https://github.com/p4hUSP/workshops_2018.2/blob/master/imgs/css/style.css">

<img src="https://github.com/p4hUSP/workshops_2018.2/blob/master/imgs/w1_02.png" class="livroR">

O que veremos hoje:

- [O que é programar? O que é um código de programação?](#intro)

- [Por que R?](#pqR)

- [Ciclo da Ciência de Dados.](#ciencia)

- [Eu vejo dados em todos os lugares!](#dados)
  
- [Como abrir arquivos TXT, CSV e Arquivos Delimitados?](#importar1)
  
- [Como abrir dados do Excel, SPSS e Stata?](#importar2)
  
- [Importar dados utilizando Webscraping.](#webscraping)
  
- [Salvando arquivos.](#salvar)

<a id='ciencia'></a>  

## Ciclo de Ciência de Dados

<img src="https://github.com/p4hUSP/workshops_2018.2/blob/master/imgs/w1_01.png" class="cienciadedados">

Assim como este é o nosso primeiro workshop, o primeiro passo na área de análise de dados é importar as informações nas quais você irá trabalhar, seja para um hobby, estágio ou iniciação cinetífica. Porém, existem diversas formas de importar dados e diversos dados que conseguimos importar, como por exemplo, podemos importar dados a partir de links, arquivos, com estruturas diversas e etc.

Esta parte da importação de dados, é o primeiro passo do _Ciclo de Ciência de Dados_ descrito no livro "R for Data Science". Depois de trazer estes arquivos para dentro do ambiente do RStudio, devemos arrumá-los, isto é, verificar suas qualidades. Este procedimento é chamado de __Data Wrangling__ (será tema do próximo workshop, fiquem ligados!) e é uma parte essencial, uma vez que as nossas perguntas muitas vezes são respondidas depois de manipularmos as bases de dados.

Mas antes de avançarmos, o que são dados?

<a id='dados'></a>

## Eu vejo dados em todos os lugares!

<img src="/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/imgs/w1_14.jpg" class="giphyembed">

O que são dados? Essa é uma pergunta bem dificíl de responder e talvez traga um discussão muito maior do que podemos imaginar. Para esse workshop, uma respota no [Quora](https://www.quora.com/What-is-data-1) para a mesma pergunta basta:

> Data is an abstraction of reality. Raw data is an observation, that  captures some elements of reality. Data can then be aggregated and analysed in a variety of ways.

Esses dados, quando coletados podem vir de diversas formas, porém se queremos analisá-los no R, ou outros softwares, teremos que transformar estas informações em tabelas.

Acontece que até mesmo as tabelas podem vir em diversos formatos, como por exemplo, `.txt`, `.sav`, `.csv` e etc; Como podemos importar estes tipos de arquivos no R? Para nossa felicidade, o R fornece algumas formas (que chamaremos de funções) para resolver os nossos problemas. Normalmente estas funções estão relacionadas com o que chamamos de pacotes, que nada mais são que um conjunto de ferramentas que possuem alguma ação, como por exemplo, "abrir arquivo csv", "filtar observação do banco de dados" e assim por diante.

Alguns exemplos de pacotes são os seguintes:

<img src="https://github.com/p4hUSP/workshops_2018.2/blob/master/imgs/w1_12.png" class="pacotes">

Para instalar um pacote no R, utilizamos uma função chamada `install.packages()`. Após instalar o pacote de interesse, você deve habilitá-lo no seu ambiente do R com a função `library()`. Vamos ao código!

```{r warning=FALSE, message=FALSE, eval = FALSE}
# Instalando o pacote beepr (repare que ele deve estar entre "")
install.packages("cowsay")
# Habilitando o pacote
library("cowsay")
# Utilizando o pacote
say(what = "Vamos importar dados!", by = "random")
```

Toda função tem o que chamamos de parâmetros, que são valores passados para trazer resultados especificos. No exemplo acima, a função `say` pede para escrevermos qual é o parametro "what" e o by. De forma intuitiva a função `say` só funcionará se nós dissermos o que falar ("what") e quem deve falar ("by").

Agora é a sua vez! Pessa para o mestre Yoda falar "may the force be with you". **Dica**: Escreva o nome do Yoda em minusculo e não esqueça das aspas.

```{r eval=FALSE}
say(what = "", by = "")
```

Conseguiu entender? Ao longo do tutorial iremos utilizar mais funções para fixar o conteúdo!

<a id='importar1'></a>

## Como abrir arquivos TXT, CSV e Arquivos Delimitados?

Neste workshop e nos próximos iremos utilizar um pacote chamado `tidyverse`. Segundo o [site do pacote](https://www.tidyverse.org/packages/), o `tidyverse`

> is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.

Como ele é uma coleção de pacotes para ciência de dados, temos como utilizar funções que vão desde como importar um dado, até como fazer visualizações e muito mais!

Dentro da área de importar dados, sobretudo, os tabulares, o `tidyverse` oferece a oportunidade de trabalharmos com os seguintes pacotes e suas funções:

- `readr`: Para importar arquivos que possuem delimitadores (.csv e .txt)

- `readxl`: Para importar arquivos do Excel (.xls e .xlsx)

- `haven`: Para importar dados de arquivos, como por exemplo, SPSS e Stata

Vamos lá!

```{r eval = FALSE}
library(tidyverse)
```

```{r eval = FALSE}
# CSV
w1_01 <- read_csv("/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/data/w1_01.csv")
View(w1_01)

# Delimitados
w1_02 <- read_delim("/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/data/w1_02.csv", delim = "@")
View(w1_02)
```

<a id='importar2'></a>

## Como abrir dados do Excel, SPSS e Stata?

```{r eval = FALSE}
# Excel
w1_06 <- read_xlsx("/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/data/w1_06.xlsx")

# STATA
w1_04 <- read_dta("/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/data/w1_04.dta")

# SPSS
w1_05 <- read_sav("/home/nathan/Documentos/Trabalho/P4H/workshops_2018.2/data/w1_05.sav")
```

Pronto! É assim que se importam dados para o R, muito fácil, não? Vamos para um desafio maior!

Uma das principais diferenças entre o Excel e o R (linguagens de programação em geral) é que o primeiro te mantem preso a uma lógica de como as coisas devem funcionar, enquanto o segundo te permite criar diversas soluções. Um exemplo disso, é o webScraping, que nada mais é que uma forma de extrair dados de sites utilizando códigos.

<a id='webscraping'></a>

## Importar dados utilizando Webscraping.

Na maioria das vezes, para não dizer sempre, extraímos informações de arquivos HTML (Hypertext Markup Language). Antes de irmos para parte prática, vamos assistir um vídeo para entender melhor o que é esse tal [HTML](https://www.youtube.com/watch?v=UjCbXQ8Coic).

Calma, nós já vamos para o R, vamos só dar uma olhada em um arquivo html. Abra o `exemplo.html` na pasta `data`.

Para fazer WebScraping no R, precisamos habilitar uma bilioteca chamada `rvest`!

```{r eval = FALSE}
library(rvest)
```

```{r eval = FALSE}
u0 <- "https://www.nexojornal.com.br/tags/Temas/Política"

node <- read_html(u0)

# Titulo das noticias
titulo <- html_nodes(node, xpath = '//div[@class="col-sm-3 col-sm-3"]//h3[@class="title "]')
titulo <- html_text(titulo)

# Classe da materia
classe <- html_nodes(node, xpath = '//div[@class="col-sm-3 col-sm-3"]//div[@class="kicker "]/a')
classe <- html_text(classe)

# Autor 
autor <- html_nodes(node, xpath = '//div[@class="meta"]/p[@class="author "]')
autor <- html_text(autor)

# Perceberam que o tamanho do vetor é menor??
## Talvez tenhamos que mudar de tag
autor <- html_nodes(node, xpath = '//div[@class="meta"]|span[@class="author "]')
autor <- html_text(autor)

# Links
link <- html_nodes(node, xpath = '//div[@class="img-container picture"]/a')
link <- html_attr(link, 'href')

# Colocando tudo em ma planilha
nexo <- data.frame(titulo = titulo, classe = classe, autor = autor, link = link)
```

### Sua vez!

Tente fazer o mesmo com a área de Economia do Nexo!

<a id='salvar'></a>  

## Salvando arquivos.

Para salvar uma tabela no R, basta que utilizamos o prefixo `write_`, seguito do tipo de arquivo que queremos salvar:

```{r eval = FALSE}
write_csv(nexo, "tabela_nexo.csv")
```

